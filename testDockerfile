# Utilisez une image de noeud officielle en utilisant la version LTS (Long-term Support)
FROM node:18-alpine as builder

# Définissez un répertoire de travail pour l'application
WORKDIR /app

# Copiez les fichiers de l'application
COPY . .

# Installez les dépendances en utilisant pnpm
RUN apk add --update --no-cache python3 build-base gcc && ln -sf /usr/bin/python3 /usr/bin/python

RUN npm install -g pnpm
RUN pnpm install

# Construisez l'application
RUN pnpm build

# Utilisez une image de noeud officielle en utilisant la version LTS (Long-term Support)
FROM node:18-alpine as nuxt-app

# Définissez un répertoire de travail pour l'application
WORKDIR /app

# Copiez les fichiers de l'application construit
COPY --from=builder /app  .

# Exposez le port utilisé par l'application
EXPOSE 8080

# Définissez l'entrée pour lancer l'application
CMD ["pnpm", "start"]